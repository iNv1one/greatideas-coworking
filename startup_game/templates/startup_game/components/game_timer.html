<!-- –ò–≥—Ä–æ–≤–æ–π —Ç–∞–π–º–µ—Ä (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç) -->
<div class="game-timer">
    <div class="timer-content">
        <div class="time-display">
            <span class="time-value" id="gameTime">08:00</span>
        </div>
        <div class="event-progress">
            <div class="progress-bar">
                <div class="progress-fill" id="eventProgress" style="width: 0%"></div>
                <div class="progress-marker"></div>
            </div>
            <div class="progress-label">–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è</div>
        </div>
        <div class="day-counter">
            <span class="day-label">DAY:</span>
            <span class="day-value" id="gameDay">1</span>
        </div>
        <div class="money-counter">
            <span class="money-label">üí∞</span>
            <span class="money-value" id="gameMoney">500</span>
        </div>
    </div>
</div>

<style>
.game-timer {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    background: rgba(0, 0, 0, 0.8);
    border-radius: 25px;
    padding: 15px 30px;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.1);
}

.timer-content {
    display: flex;
    align-items: center;
    gap: 20px;
    color: #fff;
}

.time-display {
    font-family: 'Courier New', monospace;
    font-size: 1.5rem;
    font-weight: bold;
    color: #ffa500;
    text-shadow: 0 0 10px rgba(255, 165, 0, 0.5);
}

.event-progress {
    position: relative;
    width: 200px;
    height: 8px;
}

.progress-label {
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.8);
    text-align: center;
    margin-top: 2px;
}

.progress-bar {
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #ffa500, #ff6b35);
    border-radius: 4px;
    transition: width 1s ease;
    box-shadow: 0 0 10px rgba(255, 165, 0, 0.5);
}

.progress-marker {
    position: absolute;
    top: -2px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 12px;
    background: #fff;
    border-radius: 2px;
    opacity: 0.7;
}

.day-counter {
    font-family: 'Courier New', monospace;
    font-size: 1.1rem;
    font-weight: bold;
}

.day-label {
    color: #ccc;
}

.day-value {
    color: #ffa500;
    text-shadow: 0 0 10px rgba(255, 165, 0, 0.5);
}

.money-counter {
    font-family: 'Courier New', monospace;
    font-size: 1.1rem;
    font-weight: bold;
}

.money-label {
    font-size: 1.2rem;
}

.money-value {
    color: #00ff00;
    text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
}

/* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
@media (max-width: 768px) {
    .game-timer {
        top: 10px;
        left: 10px;
        right: 10px;
        transform: none;
        padding: 10px 15px;
    }
    
    .timer-content {
        gap: 15px;
        font-size: 0.9rem;
    }
    
    .time-display {
        font-size: 1.2rem;
    }
    
    .event-progress {
        width: 120px;
    }
}
</style>

<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
function updateGameTimer(gameTime, gameDay) {
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–∏–Ω—É—Ç—ã –≤ —á–∞—Å—ã –∏ –º–∏–Ω—É—Ç—ã
    const hours = Math.floor(gameTime / 60);
    const minutes = gameTime % 60;
    const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    document.getElementById('gameTime').textContent = timeString;
    document.getElementById('gameDay').textContent = gameDay;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–π–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
    updateEventProgress();
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
let currentGameTime = 480; // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
let currentGameDay = 1;
let gamePaused = false;
let currentMoney = 500;
let nextEventTime = 0; // –í—Ä–µ–º—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
let eventTimeLeft = 0; // –û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –¥–æ —Å–æ–±—ã—Ç–∏—è

function startGameTimer() {
    setInterval(() => {
        if (gamePaused) return; // –ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –µ—Å–ª–∏ –∏–≥—Ä–∞ –Ω–∞ –ø–∞—É–∑–µ
        
        currentGameTime += 24; // 24 –º–∏–Ω—É—Ç—ã –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É = 1 –º–∏–Ω—É—Ç–∞ –Ω–∞ –¥–µ–Ω—å (1440/60 = 24)
        
        // –ï—Å–ª–∏ –ø—Ä–æ—à—ë–ª –¥–µ–Ω—å (1440 –º–∏–Ω—É—Ç = 24 —á–∞—Å–∞)
        if (currentGameTime >= 1440) {
            currentGameTime = 0;
            currentGameDay += 1;
            
            // –ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Ç—Ä–∞—Ç–∏–º 50$
            currentMoney -= 50;
            updateMoneyDisplay();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–±—ã—Ç–∏—è
            checkForEvents();
        }
        
        updateGameTimer(currentGameTime, currentGameDay);
        
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        if (Math.floor(currentGameTime / 24) % 10 === 0) {
            syncTimeWithServer();
        }
    }, 1000); // –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ–Ω–µ–≥
function updateMoneyDisplay() {
    document.getElementById('gameMoney').textContent = currentMoney;
    
    // –ï—Å–ª–∏ –¥–µ–Ω–µ–≥ –º–∞–ª–æ, –º–µ–Ω—è–µ–º —Ü–≤–µ—Ç –Ω–∞ –∫—Ä–∞—Å–Ω—ã–π
    const moneyElement = document.getElementById('gameMoney');
    if (currentMoney < 100) {
        moneyElement.style.color = '#ff0000';
        moneyElement.style.textShadow = '0 0 10px rgba(255, 0, 0, 0.5)';
    } else {
        moneyElement.style.color = '#00ff00';
        moneyElement.style.textShadow = '0 0 10px rgba(0, 255, 0, 0.5)';
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
function updateEventProgress() {
    if (eventTimeLeft <= 0) {
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è (20-40 —Å–µ–∫—É–Ω–¥)
        eventTimeLeft = 20 + Math.random() * 20;
        nextEventTime = eventTimeLeft;
    }
    
    eventTimeLeft--;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä (–æ—Ç 0% –¥–æ 100%)
    const progressPercent = ((nextEventTime - eventTimeLeft) / nextEventTime) * 100;
    document.getElementById('eventProgress').style.width = progressPercent + '%';
    
    // –ï—Å–ª–∏ –≤—Ä–µ–º—è –≤—ã—à–ª–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏–µ
    if (eventTimeLeft <= 0) {
        triggerRandomEvent();
    }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π
function checkForEvents() {
    // –ü–µ—Ä–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ 4-6 –¥–µ–Ω—å
    if (currentGameDay >= 4 && currentGameDay <= 6 && !hasEventOccurred('startup_idea')) {
        triggerEvent('startup_idea');
    }
}

// –ó–∞–ø—É—Å–∫ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
function triggerRandomEvent() {
    const events = ['market_research', 'investor_meeting', 'team_building', 'product_launch'];
    const randomEvent = events[Math.floor(Math.random() * events.length)];
    triggerEvent(randomEvent);
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞, –ø—Ä–æ–∏–∑–æ—à–ª–æ –ª–∏ —Å–æ–±—ã—Ç–∏–µ
function hasEventOccurred(eventId) {
    return localStorage.getItem('event_' + eventId) === 'true';
}

// –ó–∞–ø—É—Å–∫ —Å–æ–±—ã—Ç–∏—è
function triggerEvent(eventId) {
    gamePaused = true;
    stopSkillOrbSystem();
    localStorage.setItem('event_' + eventId, 'true');
    
    if (eventId === 'startup_idea') {
        showStartupIdeaEvent();
    } else if (eventId === 'market_research') {
        showMarketResearchEvent();
    } else if (eventId === 'investor_meeting') {
        showInvestorMeetingEvent();
    } else if (eventId === 'team_building') {
        showTeamBuildingEvent();
    } else if (eventId === 'product_launch') {
        showProductLaunchEvent();
    }
}

// –ü–æ–∫–∞–∑ —Å–æ–±—ã—Ç–∏—è "–ò–¥–µ—è —Å—Ç–∞—Ä—Ç–∞–ø–∞"
function showStartupIdeaEvent() {
    const modal = document.getElementById('eventModal');
    if (!modal) {
        createEventModal();
    }
    
    const title = document.getElementById('eventTitle');
    const description = document.getElementById('eventDescription');
    const choices = document.getElementById('eventChoices');
    
    title.textContent = '–ò–¥–µ—è —Å—Ç–∞—Ä—Ç–∞–ø–∞';
    description.textContent = '–£ –≤–∞—Å –µ—Å—Ç—å –∏–¥–µ—è —Å—Ç–∞—Ä—Ç–∞–ø–∞, –∫–æ—Ç–æ—Ä–∞—è –∏–∑–º–µ–Ω–∏—Ç –º–∏—Ä, –Ω–æ —á—Ç–æ —Å –Ω–µ–π –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ?';
    
    choices.innerHTML = `
        <button class="btn btn-primary event-choice" onclick="makeChoice('friends')">
            –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–∑—å—è–º–∏, –ø–æ–ª—É—á–∏—Ç—å –∏—Ö –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
        </button>
        <button class="btn btn-primary event-choice" onclick="makeChoice('presentation')">
            –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –ø–∏—Ç—á–∏–Ω–≥–∞ –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞–º
        </button>
        <button class="btn btn-primary event-choice" onclick="makeChoice('prototype')">
            –ó–∞–Ω—è—Ç—å—Å—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–æ–º –∏–¥–µ–∏, —á—Ç–æ–±—ã –±—ã–ª–æ —á—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å
        </button>
    `;
    
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
}

// –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è —Å–æ–±—ã—Ç–∏–π
function createEventModal() {
    const modalHTML = `
        <div class="modal fade" id="eventModal" tabindex="-1" data-bs-backdrop="static">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="eventTitle">–°–æ–±—ã—Ç–∏–µ</h5>
                        <button type="button" class="btn-close" onclick="continueGame()" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p id="eventDescription">–û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</p>
                        <div id="eventChoices" class="d-grid gap-2">
                            <!-- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-backdrop fade show" id="eventModalBackdrop"></div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

// –°–æ–±—ã—Ç–∏–µ "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä—ã–Ω–∫–∞"
function showMarketResearchEvent() {
    let modal = document.getElementById('eventModal');
    if (modal) {
        modal.remove(); // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    }
    
    createEventModal();
    modal = document.getElementById('eventModal');
    
    const title = document.getElementById('eventTitle');
    const description = document.getElementById('eventDescription');
    const choices = document.getElementById('eventChoices');
    
    title.textContent = '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä—ã–Ω–∫–∞';
    description.textContent = '–ù–∞—Å—Ç–∞–ª–æ –≤—Ä–µ–º—è –∏–∑—É—á–∏—Ç—å –≤–∞—à —Ä—ã–Ω–æ–∫. –ö–∞–∫ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å?';
    
    choices.innerHTML = `
        <button class="btn btn-success event-choice" onclick="makeChoice('survey')">
            –ü—Ä–æ–≤–µ—Å—Ç–∏ –æ–Ω–ª–∞–π–Ω-–æ–ø—Ä–æ—Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
        </button>
        <button class="btn btn-info event-choice" onclick="makeChoice('competitors')">
            –ì–ª—É–±–æ–∫–æ –∏–∑—É—á–∏—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∏ –∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
        </button>
        <button class="btn btn-warning event-choice" onclick="makeChoice('focus_group')">
            –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ñ–æ–∫—É—Å-–≥—Ä—É–ø–ø—É –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
        </button>
    `;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±–µ–∑ Bootstrap –æ–±—ä–µ–∫—Ç–∞
    modal.style.display = 'block';
    modal.classList.add('show');
    document.body.classList.add('modal-open');
}

// –°–æ–±—ã—Ç–∏–µ "–í—Å—Ç—Ä–µ—á–∞ —Å –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º"
function showInvestorMeetingEvent() {
    let modal = document.getElementById('eventModal');
    if (modal) {
        modal.remove();
    }
    
    createEventModal();
    modal = document.getElementById('eventModal');
    
    const title = document.getElementById('eventTitle');
    const description = document.getElementById('eventDescription');
    const choices = document.getElementById('eventChoices');
    
    title.textContent = '–í—Å—Ç—Ä–µ—á–∞ —Å –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º';
    description.textContent = '–£ –≤–∞—Å –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–º. –ö–∞–∫—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤—ã–±–µ—Ä–µ—Ç–µ?';
    
    choices.innerHTML = `
        <button class="btn btn-primary event-choice" onclick="makeChoice('passionate')">
            –°—Ç—Ä–∞—Å—Ç–Ω–æ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Å–≤–æ–µ–π –∏–¥–µ–µ –∏ –≤–∏–¥–µ–Ω–∏–∏
        </button>
        <button class="btn btn-secondary event-choice" onclick="makeChoice('numbers')">
            –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ —Ü–∏—Ñ—Ä–∞—Ö –∏ –±–∏–∑–Ω–µ—Å-–ø–ª–∞–Ω–µ
        </button>
        <button class="btn btn-success event-choice" onclick="makeChoice('demo')">
            –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–∏–π –ø—Ä–æ—Ç–æ—Ç–∏–ø –∏–ª–∏ –¥–µ–º–æ
        </button>
    `;
    
    modal.style.display = 'block';
    modal.classList.add('show');
    document.body.classList.add('modal-open');
}

// –°–æ–±—ã—Ç–∏–µ "–ù–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥—ã"
function showTeamBuildingEvent() {
    let modal = document.getElementById('eventModal');
    if (modal) {
        modal.remove();
    }
    
    createEventModal();
    modal = document.getElementById('eventModal');
    
    const title = document.getElementById('eventTitle');
    const description = document.getElementById('eventDescription');
    const choices = document.getElementById('eventChoices');
    
    title.textContent = '–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã';
    description.textContent = '–í–∞—à —Å—Ç–∞—Ä—Ç–∞–ø —Ä–∞—Å—Ç–µ—Ç, –∏ –≤–∞–º –Ω—É–∂–Ω—ã –Ω–æ–≤—ã–µ –ª—é–¥–∏. –ö–æ–≥–æ –∏—Å–∫–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å?';
    
    choices.innerHTML = `
        <button class="btn btn-info event-choice" onclick="makeChoice('developer')">
            –ù–∞–π—Ç–∏ –æ–ø—ã—Ç–Ω–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
        </button>
        <button class="btn btn-warning event-choice" onclick="makeChoice('marketer')">
            –ü—Ä–∏–≤–ª–µ—á—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –ø–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É
        </button>
        <button class="btn btn-danger event-choice" onclick="makeChoice('cofounder')">
            –ù–∞–π—Ç–∏ —Å–æ-–æ—Å–Ω–æ–≤–∞—Ç–µ–ª—è —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –Ω–∞–≤—ã–∫–∞–º–∏
        </button>
    `;
    
    modal.style.display = 'block';
    modal.classList.add('show');
    document.body.classList.add('modal-open');
}

// –°–æ–±—ã—Ç–∏–µ "–ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–∞"
function showProductLaunchEvent() {
    let modal = document.getElementById('eventModal');
    if (modal) {
        modal.remove();
    }
    
    createEventModal();
    modal = document.getElementById('eventModal');
    
    const title = document.getElementById('eventTitle');
    const description = document.getElementById('eventDescription');
    const choices = document.getElementById('eventChoices');
    
    title.textContent = '–ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–∞';
    description.textContent = '–í–∞—à –ø—Ä–æ–¥—É–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É! –ö–∞–∫ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –≤—ã—Ö–æ–¥–∏—Ç—å –Ω–∞ —Ä—ã–Ω–æ–∫?';
    
    choices.innerHTML = `
        <button class="btn btn-success event-choice" onclick="makeChoice('beta')">
            –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–µ—Ç–∞-–≤–µ—Ä—Å–∏—é –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        </button>
        <button class="btn btn-primary event-choice" onclick="makeChoice('full_launch')">
            –°—Ä–∞–∑—É –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –∫–∞–º–ø–∞–Ω–∏–µ–π
        </button>
        <button class="btn btn-secondary event-choice" onclick="makeChoice('soft_launch')">
            –ú—è–≥–∫–∏–π –∑–∞–ø—É—Å–∫ –¥–ª—è —É–∑–∫–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏
        </button>
    `;
    
    modal.style.display = 'block';
    modal.classList.add('show');
    document.body.classList.add('modal-open');
}

// –í—ã–±–æ—Ä —Ä–µ—à–µ–Ω–∏—è
function makeChoice(choice) {
    // –ë—Ä–æ—Å–∞–µ–º –∫—É–±–∏–∫ (1-6)
    const diceRoll = Math.floor(Math.random() * 6) + 1;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä
    localStorage.setItem('last_choice', choice);
    localStorage.setItem('last_dice_roll', diceRoll);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    showChoiceResult(choice, diceRoll);
}

// –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—ã–±–æ—Ä–∞
function showChoiceResult(choice, diceRoll) {
    const description = document.getElementById('eventDescription');
    const choices = document.getElementById('eventChoices');
    
    let resultText = '';
    
    if (choice === 'friends') {
        if (diceRoll >= 5) {
            resultText = '–î—Ä—É–∑—å—è –±—ã–ª–∏ –≤ –≤–æ—Å—Ç–æ—Ä–≥–µ –æ—Ç –≤–∞—à–µ–π –∏–¥–µ–∏! –û–Ω–∏ –¥–∞–ª–∏ –º–Ω–æ–≥–æ –ø–æ–ª–µ–∑–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤ –∏ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å. +50$ –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏!';
            currentMoney += 50;
        } else if (diceRoll >= 3) {
            resultText = '–î—Ä—É–∑—å—è –æ—Ç–Ω–µ—Å–ª–∏—Å—å –∫ –∏–¥–µ–µ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ. –ü–æ–ª—É—á–∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–º–µ—á–∞–Ω–∏–π, –Ω–æ –Ω–∏—á–µ–≥–æ –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ.';
        } else {
            resultText = '–î—Ä—É–∑—å—è –æ—Ç–Ω–µ—Å–ª–∏—Å—å –∫ –∏–¥–µ–µ —Å–∫–µ–ø—Ç–∏—á–µ—Å–∫–∏. –ü—Ä–∏—à–ª–æ—Å—å –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è. -20$ –Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏.';
            currentMoney -= 20;
        }
    } else if (choice === 'presentation') {
        resultText = '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞! –í—ã –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ –≤—Ä–µ–º—è, –Ω–æ —Ç–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤.';
    } else if (choice === 'prototype') {
        resultText = '–ü—Ä–æ—Ç–æ—Ç–∏–ø –≥–æ—Ç–æ–≤! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å —á—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º –∏ –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞–º.';
    }
    
    description.textContent = resultText;
    choices.innerHTML = `
        <button class="btn btn-success" onclick="continueGame()">
            –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É
        </button>
    `;
    
    updateMoneyDisplay();
    
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º
    syncChoiceWithServer(choice, diceRoll);
}

// –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É
function continueGame() {
    gamePaused = false;
    resumeSkillOrbSystem();
    const modal = document.getElementById('eventModal');
    const backdrop = document.getElementById('eventModalBackdrop');
    
    if (modal) {
        modal.style.display = 'none';
        modal.classList.remove('show');
        modal.remove();
    }
    
    if (backdrop) {
        backdrop.remove();
    }
    
    document.body.classList.remove('modal-open');
}

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
function syncChoiceWithServer(choice, diceRoll) {
    fetch('/game/api/choice/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            choice: choice,
            dice_roll: diceRoll,
            money: currentMoney
        })
    }).catch(err => console.log('Choice sync error:', err));
}

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
function syncTimeWithServer() {
    if (typeof fetch !== 'undefined') {
        fetch('/game/api/sync-time/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                game_time: currentGameTime,
                day: currentGameDay
            })
        }).catch(err => console.log('Sync error:', err));
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ Django (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)
    if (typeof gameTimerData !== 'undefined') {
        currentGameTime = gameTimerData.gameTime || 480;
        currentGameDay = gameTimerData.gameDay || 1;
        gamePaused = gameTimerData.gamePaused || false;
        currentMoney = gameTimerData.currentMoney || 500;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–≤—ã–∫–∏ –∏–∑ —Å–µ—Å—Å–∏–∏
        if (gameTimerData.skills) {
            currentSkills.prototype = gameTimerData.skills.prototype || 0;
            currentSkills.presentation = gameTimerData.skills.presentation || 0;
            currentSkills.pitching = gameTimerData.skills.pitching || 0;
            currentSkills.team = gameTimerData.skills.team || 0;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI —Å —Ç–µ–∫—É—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –Ω–∞–≤—ã–∫–æ–≤
            updateSkillsUI();
        }
    }
    
    updateGameTimer(currentGameTime, currentGameDay);
    updateMoneyDisplay();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–π–Ω—ã–π —Ç–∞–π–º–µ—Ä
    eventTimeLeft = 15 + Math.random() * 10; // 15-25 —Å–µ–∫—É–Ω–¥ –¥–æ –ø–µ—Ä–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
    nextEventTime = eventTimeLeft;
    
    startGameTimer();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏—Å—Ç–µ–º—É –∫—Ä—É–∂–æ—á–∫–æ–≤ –Ω–∞–≤—ã–∫–æ–≤
    startSkillOrbSystem();
});

// –°–∏—Å—Ç–µ–º–∞ –∫—Ä—É–∂–æ—á–∫–æ–≤ –Ω–∞–≤—ã–∫–æ–≤
let skillOrbInterval = null;
let activeOrbs = [];

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–≤—ã–∫–∏ —Å –∏—Ö —Ü–≤–µ—Ç–∞–º–∏ –∏ –∏–∫–æ–Ω–∫–∞–º–∏
const skillTypes = [
    { type: 'prototype', icon: '‚öôÔ∏è', name: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞' },
    { type: 'presentation', icon: 'üìä', name: '–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏' },
    { type: 'pitching', icon: 'üéØ', name: '–ü–∏—Ç—á–∏–Ω–≥' },
    { type: 'team', icon: 'üë•', name: '–¢–∏–º–±–∏–ª–¥–∏–Ω–≥' }
];

// –¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞–≤—ã–∫–æ–≤
let currentSkills = {
    prototype: 0,
    presentation: 0,
    pitching: 0,
    team: 0
};

// –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –∫—Ä—É–∂–æ—á–∫–æ–≤ –Ω–∞–≤—ã–∫–æ–≤
function startSkillOrbSystem() {
    // –°–æ–∑–¥–∞–µ–º –∫—Ä—É–∂–æ—á–∫–∏ –∫–∞–∂–¥—ã–µ 2-4 —Å–µ–∫—É–Ω–¥—ã
    skillOrbInterval = setInterval(() => {
        if (!gamePaused && Math.random() < 0.7) { // 70% —à–∞–Ω—Å —Å–æ–∑–¥–∞–Ω–∏—è
            createSkillOrb();
        }
    }, 2000 + Math.random() * 2000); // 2-4 —Å–µ–∫—É–Ω–¥—ã
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫—Ä—É–∂–æ—á–∫–∞ –Ω–∞–≤—ã–∫–∞
function createSkillOrb() {
    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –Ω–∞–≤—ã–∫
    const skillType = skillTypes[Math.floor(Math.random() * skillTypes.length)];
    
    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –∫—Ä—É–∂–æ—á–∫–∞
    const orb = document.createElement('div');
    orb.className = `skill-orb ${skillType.type}`;
    orb.textContent = skillType.icon;
    orb.setAttribute('data-skill', skillType.type);
    
    // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ (—É—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –∫—Ä—É–∂–æ—á–∫–∞)
    const leftPosition = Math.random() * (window.innerWidth - 120);
    orb.style.left = leftPosition + 'px';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
    orb.addEventListener('click', function() {
        handleSkillOrbClick(orb, skillType);
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ DOM
    document.body.appendChild(orb);
    activeOrbs.push(orb);
    
    // –£–¥–∞–ª—è–µ–º –∫—Ä—É–∂–æ—á–µ–∫ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –µ—Å–ª–∏ –Ω–µ –∫–ª–∏–∫–Ω—É–ª–∏
    setTimeout(() => {
        if (orb.parentNode) {
            orb.remove();
            const index = activeOrbs.indexOf(orb);
            if (index !== -1) {
                activeOrbs.splice(index, 1);
            }
        }
    }, 5000);
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫—Ä—É–∂–æ—á–∫—É
function handleSkillOrbClick(orb, skillType) {
    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∫–ª–∏–∫–∏
    orb.style.pointerEvents = 'none';
    orb.classList.add('clicked');
    
    // –ù–µ–±–æ–ª—å—à–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è
    orb.style.transform = 'scale(0.9)';
    setTimeout(() => {
        orb.style.transform = 'scale(1)';
    }, 100);
    
    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–∞–≤—ã–∫
    currentSkills[skillType.type]++;
    
    // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–≤—ã–∫–∞ –≤ UI
    const skillElement = document.querySelector(`.skill-item-small.${skillType.type}`);
    if (skillElement) {
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–∞
        const skillValue = skillElement.querySelector('.skill-value-small');
        if (skillValue) {
            skillValue.textContent = currentSkills[skillType.type];
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ø—É–ª—å—Å–∞—Ü–∏–∏
        skillElement.classList.add('pulse');
        setTimeout(() => {
            skillElement.classList.remove('pulse');
        }, 600);
        
        // –ê–Ω–∏–º–∏—Ä—É–µ–º –ø–æ–ª–µ—Ç –∫—Ä—É–∂–æ—á–∫–∞ –∫ –Ω–∞–≤—ã–∫—É
        animateOrbToSkill(orb, skillElement);
    }
    
    // –£–¥–∞–ª—è–µ–º –∫—Ä—É–∂–æ—á–µ–∫ –∏–∑ –º–∞—Å—Å–∏–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö
    const index = activeOrbs.indexOf(orb);
    if (index !== -1) {
        activeOrbs.splice(index, 1);
    }
    
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º
    syncSkillWithServer(skillType.type, currentSkills[skillType.type]);
}

// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–ª–µ—Ç–∞ –∫—Ä—É–∂–æ—á–∫–∞ –∫ –Ω–∞–≤—ã–∫—É
function animateOrbToSkill(orb, skillElement) {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞–∑–æ–≤—É—é –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ–¥—ä–µ–º–∞
    orb.style.animation = 'none';
    
    const orbRect = orb.getBoundingClientRect();
    const skillRect = skillElement.getBoundingClientRect();
    
    // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ –∫—Ä—É–∂–æ—á–∫–∞ –¥–æ –Ω–∞–≤—ã–∫–∞
    const deltaX = skillRect.left + skillRect.width/2 - (orbRect.left + orbRect.width/2);
    const deltaY = skillRect.top + skillRect.height/2 - (orbRect.top + orbRect.height/2);
    
    // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é float-up –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—à—É
    orb.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    orb.style.transform = `translate(${deltaX}px, ${deltaY}px) scale(0.2)`;
    orb.style.opacity = '0.8';
    
    // –ß–µ—Ä–µ–∑ –ø–æ–ª—Å–µ–∫—É–Ω–¥—ã –¥–µ–ª–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
    setTimeout(() => {
        orb.style.opacity = '0';
        orb.style.transform = `translate(${deltaX}px, ${deltaY}px) scale(0.1)`;
    }, 600);
    
    // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    setTimeout(() => {
        if (orb.parentNode) {
            orb.remove();
        }
    }, 800);
}

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞–≤—ã–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
function syncSkillWithServer(skillType, value) {
    if (typeof fetch !== 'undefined') {
        fetch('/game/api/skill/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                skill_type: skillType,
                value: value
            })
        }).catch(err => console.log('Skill sync error:', err));
    }
}

// –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∫—Ä—É–∂–æ—á–∫–æ–≤ (–¥–ª—è –ø–∞—É–∑—ã –∏–≥—Ä—ã)
function stopSkillOrbSystem() {
    if (skillOrbInterval) {
        clearInterval(skillOrbInterval);
        skillOrbInterval = null;
    }
    
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫—Ä—É–∂–æ—á–∫–∏
    activeOrbs.forEach(orb => {
        if (orb.parentNode) {
            orb.remove();
        }
    });
    activeOrbs = [];
}

// –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∫—Ä—É–∂–æ—á–∫–æ–≤
function resumeSkillOrbSystem() {
    if (!skillOrbInterval) {
        startSkillOrbSystem();
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –Ω–∞–≤—ã–∫–æ–≤
function updateSkillsUI() {
    Object.keys(currentSkills).forEach(skillType => {
        const skillElement = document.querySelector(`.skill-item-small.${skillType}`);
        if (skillElement) {
            const skillValue = skillElement.querySelector('.skill-value-small');
            if (skillValue) {
                skillValue.textContent = currentSkills[skillType];
            }
        }
    });
}
</script>